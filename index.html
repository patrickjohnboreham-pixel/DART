<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DART (alpha)</title>
<link rel="manifest" href="manifest.json?v=4">
<meta name="theme-color" content="#0b5fff">

<link rel="stylesheet" href="assets/css/dart.css?v=5">

</head>
<body>
  <div id="disclaimerModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; color:#fff; font-family:sans-serif;">
  <div style="background:#fff; color:#000; max-width:600px; margin:10% auto; padding:24px; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.2); text-align:center;">
    <h2>Disclaimer</h2>
    <p>
      This tool is independently developed and is not officially endorsed by the Department of Transport and Main Roads. 
      It is intended as a reference guide only. Users must verify all assessments against current legislation and policy. 
      The developer accepts no responsibility for misuse or incorrect use. DART is currently in active development and may be
      subject to ongoing updates and changes.
    </p>
    <p><strong>Do you accept and agree to use this tool as intended?</strong></p>
    <button onclick="acceptDisclaimer()" style="margin: 10px; padding:10px 20px;">I Agree</button>
    <button onclick="rejectDisclaimer()" style="margin: 10px; padding:10px 20px; background:#f44336; color:#fff;">I Do Not Agree</button>
  </div>
</div>

<!-- Banner -->
<div id="banner">
  <h1>Defect Assessment and Reporting Tool</h1>
  <h2>DART</h2>
</div>


<!-- Tab Buttons -->
<div class="tabbar">
  <button type="button" class="tablink active" data-tab="home">Home</button>
  <button type="button" class="tablink" data-tab="measurements">Vehicle Measurements</button>
  <button type="button" class="tablink" data-tab="inspection">Inspection</button>
  <button type="button" class="tablink" data-tab="askDart">Ask DART</button>
  <button type="button" class="tablink" data-tab="photos">Vehicle Photos</button>
  <button type="button" class="tablink" data-tab="results">Results</button>
  <button type="button" class="tablink" data-tab="help">Help</button>
</div>


<!-- Home Tab -->
<div id="home" class="tab-content active">


  <!-- Quick Links -->
  <h3>Quick Links</h3>
<div class="link-buttons">
  <a href="https://www.rover.infrastructure.gov.au/RAVPublicSearch/" target="_blank" rel="noopener">
    RAV Search (Post 2021)
  </a>
  <a href="https://myrta.com/rvd/index.jsp;jsessionid=9E98CE1089B8D52943E712239D069C16" target="_blank" rel="noopener">
    RVD (Pre 2001)
  </a>
</div>



  <h3>Vehicle Details</h3>
  <p><em>Enter the details of the inspected vehicle.</em></p>

  <label>Registration:</label>
<input type="text" id="rego" placeholder="Feature disabled" disabled><br>

  <label>Make:</label>
  <input type="text" id="make" placeholder="e.g. Toyota"><br>

  <label>Model:</label>
  <input type="text" id="model" placeholder="e.g. Yaris"><br>

  <label>Year:</label>
  <input type="number" id="year" placeholder="e.g. 2023"><br>

  <label>Approval Number:</label>
  <input type="text" id="approval" placeholder="e.g. 12345"><br>

  <!-- Engineering Mod Codes -->
  <h3>Engineering Mod Codes</h3>
  <p><em>Enter mod codes if applicable (e.g. LM1, LS10). Separate multiple codes with commas.</em></p>
 <input type="text" id="modCodes" placeholder="e.g. LM1, LS9, LS10">
  <button type="button" id="modCodeButton" class="action">Check Codes</button>
  <button type="button" id="modCodeClear" class="action action-secondary">
  Clear Codes
</button>


  <div id="modDescriptions" class="result"></div>

  <!-- RVD Measurements (Stock) -->
  <h3>Road Vehicle Descriptor (RVD) Measurements</h3>
  <p><em>Enter RVD measurements collected from the links provided above.</em></p>

  <h4>Suspension</h4>
  <p><em>Measurements taken from wheel center to lower guard.</em></p>

  <label>Front (stock/RVD):</label>
  <input type="number" id="suspensionFront" placeholder="e.g. 540"><br>

  <label>Rear (stock/RVD):</label>
  <input type="number" id="suspensionRear" placeholder="e.g. 550"><br>

  <h4>Wheel Track</h4>
  <p><em>Measurement centre of tyre to centre of tyre.</em></p>

  <label>Front:</label>
  <input type="number" id="trackFront" placeholder="e.g. 1620"><br>

  <label>Rear:</label>
  <input type="number" id="trackRear" placeholder="e.g. 1620"><br>

  <h3>Tyre Sizes</h3>
<p><em>Enter multiple sizes, one per line or separated by commas (optional).</em></p>
<textarea id="tyreSizes" rows="5" style="width:100%; max-width:480px;" placeholder="205/80R16
7.50R16
255/70R15LT
31x10.50R15"></textarea>
<br>
<button type="button" id="calcLargestTyre" class="action">Calculate Largest</button>
<div id="largestTyreResult" style="margin-top:8px; font-size:14px; color:#333;"></div>


<!-- Save Details -->
<button type="button" class="action" onclick="saveVehicleDetails()">Save Details</button>
<p class="footer-note">
    This application was developed by P Boreham.  
    Enquiries and feedback: <a href="mailto:patrickjohnboreham@gmail.com">patrickjohnboreham@.gmail.com</a>
</p>

<div id="vehicleSummary" class="summary"></div>


</div>

<!-- Vehicle Measurements Tab -->
<div id="measurements" class="tab-content">
  <p><em>Enter the measured (current) values you took on the vehicle today.</em></p>

  <!-- Suspension (measured) -->
  <div class="section">
    <h3>Suspension</h3>
    <p><em>Wheel centre ‚Üí lower guard (mm)</em></p>

    <label>Front (measured):</label>
    <input type="number" id="measFront" placeholder="e.g. 560"> mm<br>

    <label>Rear (measured):</label>
    <input type="number" id="measRear" placeholder="e.g. 560"> mm
  </div>

  <!-- Wheel Track (measured) -->
  <div class="section section-spaced">
    <h3>Wheel Track</h3>
    <p><em>Centre of tyre to centre of tyre (mm)</em></p>

    <label>Front (measured):</label>
    <input type="number" id="measTrackFront" placeholder="e.g. 1660"> mm<br>

    <label>Rear (measured):</label>
    <input type="number" id="measTrackRear" placeholder="e.g. 1660"> mm
  </div>

  <!-- Tyres (measured tab, separate from Home) -->
  <div class="section section-spaced">
  <h3>Tyres</h3>
  <p><em>Enter measured tyre size. Accepts metric (e.g. 265/75R16) or imperial (e.g. 35/12.5R16).</em></p>

  <label>Tyre Size (measured):</label>
  <input type="text" id="m_tyreSize" placeholder="265/75R16 or 35/12.5R16">
  <div id="m_tyreParsed" class="result"></div>
</div>

  <!-- Action -->
  <button type="button" id="compileBtn" class="action">Calculate in results</button>
  <p class="small-note"><em>This will read the RVD ‚Äústock‚Äù numbers you entered on the Home tab (Suspension/Track) and compare with these measured values.</em></p>
</div>

<!-- Inspection Tab -->
<div id="inspection" class="tab-content">
  <h3>Inspection</h3>
  <p><em>Questions are optional.</em></p>

  <!-- Wrapper: JS will sort these .section blocks alphabetically by data-label -->
  <div id="inspectionQuestions">

    <!-- Body Blocks -->
    <div class="section" data-label="Body Blocks">
      <h4>Body Blocks</h4>
      <p>Are body blocks fitted to this vehicle?</p>
      <div class="btn-row">
        <button type="button" id="bbYes" class="action">Yes</button>
        <button type="button" id="bbNo"  class="action">No</button>
      </div>

      <!-- Follow-up (only if LS10 present after "Yes") -->
      <div id="bbFollow" style="display:none; margin-top:8px;">
        <p>Are the body blocks less than or equal to 50 mm high?</p>
        <div class="btn-row">
          <button type="button" id="bbLe50Yes" class="action">Yes</button>
          <button type="button" id="bbLe50No"  class="action">No</button>
        </div>
      </div>

      <!-- Status line for Body Blocks -->
      <div id="bbStatus" class="result"></div>
    </div>

    <!-- Sway bar -->
    <div class="section" data-label="Sway bar">
      <h4>Sway bar</h4>
      <p>Are any sway bar components broken, loose, unduly worn, disconnected, or removed?</p>
      <div class="btn-row">
        <button type="button" id="swayYes" class="action">Yes</button>
        <button type="button" id="swayNo"  class="action">No</button>
      </div>

      <!-- Status line for Sway bar -->
      <div id="swayStatus" class="result"></div>
    </div>


<!-- Suspension Shackles -->
<div class="section" data-label="Suspension Shackles">
  <h4>Suspension Shackles</h4>
  <p>Are extended spring shackles fitted?</p>
  <div class="btn-row">
    <button type="button" id="shackleYes" class="action">Yes</button>
    <button type="button" id="shackleNo"  class="action">No</button>
  </div>

  <!-- Status line -->
  <div id="shackleStatus" class="result"></div>
</div>

    <!-- Add more questions like this:
    <div class="section" data-label="Bull bar">
      <h4>Bull bar</h4>
      ...buttons/outputs...
    </div>
    -->
  </div>
</div>

<!-- Ask DART Tab -->
<div id="askDart" class="tab-content">
  <h2>Ask DART</h2>
  <p><em>Search Queensland Light Vehicle Inspection Manual</em></p>

  <input
  type="text"
  id="dartSearch"
  placeholder="Type a vehicle defect..."
/>

  <button type="button" class="action" onclick="searchQLVIM()">Search</button>

 <div id="searchResults"></div>
</div> <!-- /#askDart -->

<!-- Vehicle Photos Tab -->
<div id="photos" class="tab-content">
  <h3>Upload Vehicle Photos</h3>
  <p style="color: red; font-weight: bold;">
    üö´ Photo uploads are currently disabled. Please use departmental systems for image capture.
  </p>
  <input 
    type="file" 
    accept="image/*" 
    capture="environment" 
    multiple 
    disabled 
    title="This feature is disabled in the current version of DART.">
</div>


<!-- Results Tab -->
   
<div id="results" class="tab-content">
  <h3>Results</h3>
 <div id="resultsKey" class="result">
    <strong><span class="status-ok">Compliant</span></strong> - No issues detected. &nbsp; | &nbsp; 
    <strong><span class="status-bad">Defective</span></strong> - Non-compliant, rectification required.
</div>

<!-- Where photos will be shown in the Results before printing -->
<div id="resultsPhotos" class="summary"></div>

  


    <!-- Saved Vehicle Summary (from Home) -->
  <div id="resultsVehicleSummary" class="summary"></div>
  <div id="frontResult" class="result"></div>
  <div id="rearResult" class="result"></div>
  <div id="summary" class="summary"></div>
<div id="inspectionResults" class="result"></div>

  <!-- Wheel Track warning (only shows if >50mm) -->
  <div id="trackAlert" class="result"></div>

  <!-- Inspection findings -->
  <div id="inspectionResults" class="result"></div>

  <!-- Tyre Diameter warning (only shows if >50mm increase) -->
  <div id="tyreDiaAlert" class="result"></div>

 <!-- Save as PDF -->
<button 
  type="button" 
  class="action" 
  disabled 
  title="This feature is currently disabled. Use departmental systems for reporting.">
  Save Report as PDF
</button>
<p style="color: red; margin-top: 8px;"><strong>
  üö´ This feature is currently disabled in DART.<br>
  Please use official departmental systems to generate reports.
</strong></p>

<p style="font-style: italic; font-size: 0.9em; color: #555; margin-top: 24px;">
  This tool is independently developed and is not officially endorsed by the Department of Transport and Main Roads.  
  It is intended as a reference guide only. Users must verify all assessments against current legislation and policy.  
  The developer accepts no responsibility for misuse or incorrect use.  
  DART is currently in active development and may be subject to ongoing updates and changes.
</p>

</div>

<!-- Help Tab -->
<div id="help" class="tab-content">
  <h3>Help</h3>
  <p><em>Tap an image or document to open full screen in a new tab.</em></p>

  <div class="help-grid">
    <a href="Help/helpphoto1.jpg" class="action" target="_blank" rel="noopener external">Tyre Diameter</a>
    <a href="Help/helpphoto2.jpg" class="action" target="_blank" rel="noopener external">Sway Bar</a>
    <a href="Help/helpphoto3.jpg" class="action" target="_blank" rel="noopener external">Wheel Track</a>
    <a href="Help/helpphoto4.jpg" class="action" target="_blank" rel="noopener external">Suspension Height</a>
    <a href="Help/helpphoto5.jpg" class="action" target="_blank" rel="noopener external">Body Blocks</a>
  </div>

  <h3 style="margin-top:20px;">Reference Documents</h3>
  <div class="help-grid">
    <a href="assets/QLVIM.pdf" class="action" target="_blank" rel="noopener external">
      Queensland Light Vehicle Inspection Manual (QLVIM PDF)
    </a>
  </div>

  <!-- Defect Clearance Wording -->
  <div class="section" id="defectClearance">
  <h3>Defect Clearance Wording</h3>

  <label for="dcLocation"><strong>Select Location:</strong></label>
  <select id="dcLocation" class="action" disabled title="This feature is currently disabled. Use official TMR templates.">
    <option value="" selected disabled>‚Äî Select a location ‚Äî</option>
    <option value="Bethania">Bethania</option>
    <option value="Cairns">Cairns</option>
    <option value="Carseldine">Carseldine</option>
    <option value="Maroochydore">Maroochydore</option>
    <option value="Rockhampton">Rockhampton</option>
    <option value="Toowoomba">Toowoomba</option>
    <option value="Townsville">Townsville</option>
  </select>

  <p style="color: red; margin-top: 8px;"><strong>üö´ This section is disabled in the current version of DART.<br>Please use the official departmental resources for clearance instructions.</strong></p>
</div>

</div>

<!-- Output (hidden until selection) -->
<div id="dcOutput" class="result" style="display:none; white-space:pre-wrap; margin-top:12px;"></div>




<script src="assets/js/app.js?v=31" defer></script>
<script>
document.addEventListener("click", (e) => {
  const target = e.target;
  if (!(target instanceof Element)) return;

  // Only affect Help photos + QLVIM links
  const a = target.closest('#help .help-grid a.action, a.qlvim-link');
  if (!a) return;

  // Save tab so we return to Help
  localStorage.setItem("lastTab", "help");

  const url = a.href;

  if (navigator.userAgent.includes("Android")) {
    // ANDROID PWA: open in external Chrome via intent (no popup)
    e.preventDefault();
    window.location.href = `intent://${url.replace(/^https?:\/\//, '')}#Intent;scheme=https;package=com.android.chrome;end`;
  } else {
    // DESKTOP / iOS: let the native anchor open the new tab (no window.open)
    // Ensure attributes are correct, then allow default click to proceed
    a.target = "_blank";
    const rel = (a.getAttribute("rel") || "").toLowerCase();
    if (!rel.includes("noopener")) a.setAttribute("rel", (rel + " noopener").trim());
    if (!rel.includes("external")) a.setAttribute("rel", (a.getAttribute("rel") + " external").trim());
    // IMPORTANT: do NOT call preventDefault() here
  }
});
</script>
<!-- üîÑ DART auto-update service worker -->
<script>
const BUILD = '2025-10-11_05'; // bump on each deploy

if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
    const SW_PATH = location.pathname.includes('/DART/') ? '/DART/sw.js' : '/sw.js';
const reg = await navigator.serviceWorker.register(`${SW_PATH}?v=${BUILD}`);

      const check = () => reg.update().catch(()=>{});
      check();
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) check();
      });

      let reloaded = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (!reloaded) { reloaded = true; location.reload(); }
      });

      if (reg.waiting) reg.waiting.postMessage({type:'SKIP_WAITING'});
      reg.addEventListener('updatefound', () => {
        const nw = reg.installing;
        if (!nw) return;
        nw.addEventListener('statechange', () => {
          if (nw.state === 'installed' && reg.waiting) {
            reg.waiting.postMessage({type:'SKIP_WAITING'});
          }
        });
      });
    } catch(err) {
      console.error('SW registration failed:', err);
    }
  });
}
</script>



</body>
</html>
